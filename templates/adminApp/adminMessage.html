{% extends 'base/adminbase.html' %}
{% load crispy_forms_tags %}
{% load static %}





{% block 'search' %}
<input type="text" name="search" class="form-control" placeholder="Search By User Name...">
{% endblock %}


{% block 'body' %}



<!--**********************************
            Sidebar end
        ***********************************-->

        <!--**********************************
            Content body start
        ***********************************-->
<section  style="height:500px; background-color: #fff;">
        <div class="container-fluid mt-3">
            <div class="container" style="margin-left: 300px;">
                <div class="row">
                    <div class="col-12" style="height: 400px;">
                        <br>
                        <br>
                        <div class="card">
                            <div class="card-body">



                                <div class="h-screen bg-gray-100 py-10 px-4 sm:px-6 lg:px-8">
                                    <div class="chat-container bg-white max-w-xl mx-auto rounded-lg shadow-md overflow-hidden">
                                
                                        <div class="chat-header bg-primary text-white p-4">
                                            {{ recipient_username }}
                                        </div>
                                
                                        <div class="chat-messages bg-dark h-96 overflow-auto p-4" id="chat-box">
                                        </div>
                                
                                        <div class="border-top border-gray-200 p-4">
                                            <input type="text" class="form-control rounded-md border focus:ring-primary focus:border-primary"
                                                id="chat-input" placeholder="Type your message..." />
                                        </div>
                                    </div>
                                    <script> 
                                        const chatSocket = new WebSocket('ws://' + window.location.host + '/ws/chat/{{ recipient_username }}/');
                                        
                                        document.querySelector('#chat-input').addEventListener('keyup', function (e) {
                                            if (e.key === 'Enter') {
                                                const messageInput = document.querySelector('#chat-input');
                                                const message = messageInput.value;
                                                chatSocket.send(JSON.stringify({
                                                    'message': message
                                                }));
                                                messageInput.value = '';
                                            }
                                        });
                                        
                                        chatSocket.onmessage = function (e) {
                                            const data = JSON.parse(e.data);
                                            const message = data['message'];
                                            const sender = data['sender'];
                                            const chatBox = document.getElementById('chat-box');
                                            const messageElement = document.createElement('div');
                                            const messageContent = document.createElement('span');
                                        
                                            if (sender === "{{ request.user.username }}") {
                                        
                                                messageElement.classList.add('mb-2', 'flex', 'justify-end');
                                                messageContent.classList.add('p-3', 'rounded-md', 'bg-indigo-600', 'text-white');
                                            } else {
                                        
                                                messageElement.classList.add('mb-2', 'flex', 'justify-start');
                                                messageContent.classList.add('p-3', 'rounded-md', 'bg-gray-300', 'text-gray-900');
                                            }
                                        
                                            messageContent.textContent = `[${sender}]: ${message}`;
                                            messageElement.appendChild(messageContent);
                                            chatBox.appendChild(messageElement);
                                            chatBox.scrollTop = chatBox.scrollHeight;
                                        };
                                        
                                          </script>
                                    
                                </div>



                            
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</section>
    <!--**********************************
        Main wrapper end
    ***********************************-->

    <!--**********************************
        Scripts
    ***********************************-->

    <section style="height:290px">
        <!--**********************************
           Sidebar start
       ***********************************-->
       <div class="nk-sidebar bg-dark">
           <div class="">
               <br>
               <ul class="metismenu" id="menu" style=" background-color: #1877F2;">
                   <li>
                       <a href="{% url 'board' %}" aria-expanded="false">
                           <i class="icon-speedometer menu-icon"></i><span class="nav-text" style="color:white" class="text-decoration-none"><i class="fa fa-clipboard"></i> Dashboard</span>
                       </a>
                   </li>
                   <li class="mega-menu mega-menu-sm" style=" background-color: #1877F2;">
                       <a class="has-arrow">
                           <i class="icon-screen-tablet menu-icon"></i>
                           <span class="nav-text" style="color:white " class="text-decoration-none"><i class="fa fa-user-circle"></i> Admin</span>
                       </a>
                       <ul style=" background-color: #1877F2;">
                        {% if user.is_superuser or user.is_staff  %} 
                        <li><a href="/all-user/" style="color:white" class="text-decoration-none"><i class="fa fa-users" style="color: white;"></i>    All User</a></li>
                        {% endif %}
                        {% comment %} {% if request.user.userprofile_set.first.verified == True %} {% endcomment %}
                        <li><a href="{% url 'approve-owner' %}" style="color:white" class="text-decoration-none"><i class="fa fa-list-alt" style="color: white;"></i>    Approve Listings</a></li>
                        
                        <li><a href="/approve-admin/" style="color:white" class="text-decoration-none"><i class="fa fa-columns" style="color: white;"></i>    Admin Panel</a></li>
                        {% comment %} {% endif %} {% endcomment %}
                        
                        <li><a href="{% url 'manage-owner-task' %}" style="color:white" class="text-decoration-none"><i class="fa fa-home" style="color: white;"></i>    Manage Owner Task</a></li>
                        <li><a href="" style="color:white" class="text-decoration-none"><i class="fa fa-building" style="color: white;"></i>    Manage Tenant Task</a></li>
                        <li><a href="{% url 'manage-customer' %}" style="color:white" class="text-decoration-none"><i class="fa fa-users" style="color: white;"></i>    Manage Users</a></li>
                        <li>
                            <a href="/admin-helpdesk/" style="color:white" class="text-decoration-none"><i class="fa fa-life-ring" style="color: white;"></i>    Admin Helpdesk</a>
                        </li>

                        <li>
                            {% if user.is_superuser or user.is_staff  %}
                            <a href="{% url 'add-admin' %}" style="color:white" class="text-decoration-none" ><i class="fa fa-user" style="color: white;"></i>    Add admin</a>
                            {% endif %}
                        </li>
                        <li class="list-group-item"> <a href="{% url 'admin_tenant' recipient_username=request.user %}"
                            class="text-decoration-none text-black">Messages</a> </li>
                       </ul> 
                   </li>
                   {% comment %} {% endif %} {% endcomment %}
               </ul>
           </div>
       </div>
       <hr style="border-color: black; border-width: 2px; margin-top: 20px; margin-bottom: 20px; width:200px;">
   </section>



   
    {% endblock %}


   