{% extends 'base/adminbase.html' %}
{% load crispy_forms_tags %}
{% load static %}




{% block 'body' %}
 
<!--**********************************
    Content body start
***********************************-->
<style>
    .content-body {
        background-color: #f9f9f9; /* Light gray background color */
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Soft shadow */
        margin-bottom: 20px; /* Add margin to separate from other elements */
    }

    table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Soft shadow for the table */
    }

    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0; /* Light border color */
    }

    th {
        background-color: #f2f2f2; /* Header background color */
    }

    tbody tr:last-child td {
        border-bottom: none; /* Remove border for last row */
    }

    tbody tr:hover {
        background-color: #f5f5f5; /* Hover background color */
    }
</style>

<section class="vh-100" style="background-color: #eee;">
    <br>
    <br>
    <div class="content-body">
        <!-- Display booking history -->
        <h2>Booking History</h2>

        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>house_id</th>
                        <th>Payment ID</th>
                        <th>Owner</th>
                        <th>Total Price</th>
                        

                        <th>Booking Status</th>
                        <th>Payment Status</th>
                    
                        <th>Action</th>
                        <th>Send Re</th> <!-- New column for sending email notification -->
                    </tr>
                </thead>
                <tbody>
                    {% for booking in all_bookings %}
                        <tr><td>
                            <span class="badge badge-secondary">{{ booking.id|stringformat:"s"|slice:":3" }}</span>
                        </td>
                        <td>
                            <span class="badge badge-secondary">{{ booking.house_id|stringformat:"s"|slice:":3" }}</span>
                        </td>   
                            <td>
                                <span class="badge badge-secondary">{{ booking.payment_id|stringformat:"s"|slice:":3" }}</span>
                            </td>                               <td>{{ booking.house.seller.user }}</td>
                   
                            <td>{{ booking.total_price }}</td>
                            <td>{{ booking.booking_status }}</td>
                            <td>{{ booking.payment_status }}</td>
                            <td>
                                {% if booking.booking_status == 'pending' %}
                                    <form id="cancel_form_{{ booking.id }}" action="{% url 'cancel_booking' booking.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-danger cancel-button" data-booking-id="{{ booking.id }}">Cancel</button>
                                    </form>
                                {% else %}
                                    <!-- If booking status is not pending, display an inactive button -->
                                    <button type="button" class="btn btn-secondary" disabled>Action</button>
                                {% endif %}
                            </td>
                            <td>
                                {% if booking.booking_status == 'pending' %}
                                    <form id="send_email_form_{{ booking.id }}" action="{% url 'send_email_notification' booking.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-primary send-email-button" data-booking-id="{{ booking.id }}">Send Report</button>
                                    </form>
                                {% else %}
                                    <!-- If booking status is not pending, display an inactive button -->
                                    <button type="button" class="btn btn-secondary" disabled>Reported</button>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if not all_bookings %}
            <p>No booking history available.</p>
        {% endif %}
    </div>
</section>








    <section style="height:50px">
        <!--**********************************
           Sidebar start
       ***********************************-->
       <div class="nk-sidebar">
           <div class="">
               <br>
               <ul class="metismenu" id="menu">
                   <li>
                       <a href="{% url 'dashboard_renter' %}" aria-expanded="false">
                           <i class="icon-speedometer menu-icon"></i><span class="nav-text">Dashboard</span>
                       </a>
                   </li>
                
                   <li class="mega-menu mega-menu-sm">
                       <a class="has-arrow">
                           <i class="icon-screen-tablet menu-icon"></i>
                           <span class="nav-text">Tenant</span>
                       </a>
                       <ul> 
                    
                        <li><a href="{% url 'messages' %}">messages</a></li>
                        <li>
                            <a href="{% url 'payments' %}">Payment history</a>
                        </li>

                      
                        <li>
                            <a href="{% url 'books' %}">Books</a>
                        </li>
                       </ul>
                   </li>
                   {% comment %} {% endif %} {% endcomment %}
               </ul>
           </div>
       </div>
       <hr style="border-color: black; border-width: 2px; margin-top: 20px; margin-bottom: 20px; width:200px;">
   </section>
    {% endblock %}

   
    {% block 'footer2' %}

    {% endblock %}